{"ast":null,"code":"import{useEffect,useState}from\"react\";import axios from\"axios\";import ArtistList from\"../components/ArtistList\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Callback=()=>{const[token,setToken]=useState(\"\");const[userData,setUserData]=useState(null);const[userTopItemsData,setUserTopItemsData]=useState(null);useEffect(()=>{const hash=window.location.hash;let tokenFromLocalStorage=window.localStorage.getItem(\"token\");if(!tokenFromLocalStorage&&hash){const tokenFromHash=hash.substring(1).split(\"&\").find(elem=>elem.startsWith(\"access_token\"));if(tokenFromHash){tokenFromLocalStorage=tokenFromHash.split(\"=\")[1];window.localStorage.setItem(\"token\",tokenFromLocalStorage);}}setToken(tokenFromLocalStorage);},[token]);// useEffect to display personal user information on the web page\nuseEffect(()=>{const token=window.localStorage.getItem(\"token\");const base_url=\"https://api.spotify.com/v1/me\";const header_payload={Authorization:`Bearer ${token}`};axios.get(`${base_url}`,{headers:header_payload}).then(res=>{setUserData(res.data);console.log(`Granted scopes: ${res.data.scope}`);}).catch(error=>{console.log(`Error occurred while fetching user info: ${error}`);});},[]);// get user's top items:\nuseEffect(()=>{const token=window.localStorage.getItem(\"token\");const base_url=\"https://api.spotify.com/v1/me/top/artists\";const header_payload={Authorization:`Bearer ${token}`};axios.get(`${base_url}?time_range=medium_term&limit=10`,{headers:header_payload}).then(res=>{console.log(res.data);setUserTopItemsData(res.data);}).catch(error=>{console.log(`Error occurred while fetching user info: ${error}`);});},[]);const handleLogOut=()=>{setToken(\"\");window.localStorage.removeItem(\"token\");window.location.href=\"/\";};if(!userData&&!userTopItemsData){return/*#__PURE__*/_jsx(\"div\",{children:\"Loading...\"});}return/*#__PURE__*/_jsxs(\"div\",{className:\"App\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"This is the callback page.\"}),/*#__PURE__*/_jsx(\"button\",{className:\"spotify-btn\",onClick:handleLogOut,children:\"Log out from Spotify\"}),userData&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"h1\",{children:[\"Welcome, \",userData.display_name,\"!\"]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Spotify Profile:\",\" \",/*#__PURE__*/_jsx(\"a\",{href:userData.external_urls.spotify,target:\"_blank\",rel:\"noopener noreferrer\",children:\"Visit Profile\"})]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Followers: \",userData.followers.total]}),userData.images&&userData.images.length>0&&/*#__PURE__*/_jsx(\"img\",{src:userData.images[0].url,alt:userData.display_name,width:userData.images[0].width,height:userData.images[0].height})]}),userTopItemsData&&/*#__PURE__*/_jsx(ArtistList,{artists:userTopItemsData.items})]});};export default Callback;","map":{"version":3,"names":["useEffect","useState","axios","ArtistList","jsx","_jsx","jsxs","_jsxs","Callback","token","setToken","userData","setUserData","userTopItemsData","setUserTopItemsData","hash","window","location","tokenFromLocalStorage","localStorage","getItem","tokenFromHash","substring","split","find","elem","startsWith","setItem","base_url","header_payload","Authorization","get","headers","then","res","data","console","log","scope","catch","error","handleLogOut","removeItem","href","children","className","onClick","display_name","external_urls","spotify","target","rel","followers","total","images","length","src","url","alt","width","height","artists","items"],"sources":["/Users/godfather/Desktop/TUS School Stuff/spotify_web_api_project/frontend/src/pages/Callback.tsx"],"sourcesContent":["import { useEffect, useState } from \"react\";\nimport { UserData } from \"../interfaces/UserData\";\nimport axios from \"axios\";\nimport { UserTopItemsData } from \"../interfaces/UserTopItems\";\nimport ArtistList from \"../components/ArtistList\";\n\nconst Callback = () => {\n  const [token, setToken] = useState(\"\");\n  const [userData, setUserData] = useState<UserData | null>(null);\n  const [userTopItemsData, setUserTopItemsData] =\n    useState<UserTopItemsData | null>(null);\n\n  useEffect(() => {\n    const hash = window.location.hash;\n    let tokenFromLocalStorage = window.localStorage.getItem(\"token\") as string;\n\n    if (!tokenFromLocalStorage && hash) {\n      const tokenFromHash = hash\n        .substring(1)\n        .split(\"&\")\n        .find((elem) => elem.startsWith(\"access_token\"));\n\n      if (tokenFromHash) {\n        tokenFromLocalStorage = tokenFromHash.split(\"=\")[1];\n        window.localStorage.setItem(\"token\", tokenFromLocalStorage);\n      }\n    }\n    setToken(tokenFromLocalStorage);\n  }, [token]);\n\n  // useEffect to display personal user information on the web page\n  useEffect(() => {\n    const token = window.localStorage.getItem(\"token\");\n    const base_url = \"https://api.spotify.com/v1/me\";\n    const header_payload = {\n      Authorization: `Bearer ${token}`,\n    };\n    axios\n      .get(`${base_url}`, { headers: header_payload })\n      .then((res) => {\n        setUserData(res.data);\n        console.log(`Granted scopes: ${res.data.scope}`);\n      })\n      .catch((error) => {\n        console.log(`Error occurred while fetching user info: ${error}`);\n      });\n  }, []);\n\n  // get user's top items:\n  useEffect(() => {\n    const token = window.localStorage.getItem(\"token\");\n    const base_url = \"https://api.spotify.com/v1/me/top/artists\";\n    const header_payload = {\n      Authorization: `Bearer ${token}`,\n    };\n    axios\n      .get(`${base_url}?time_range=medium_term&limit=10`, {\n        headers: header_payload,\n      })\n      .then((res) => {\n        console.log(res.data);\n        setUserTopItemsData(res.data);\n      })\n      .catch((error) => {\n        console.log(`Error occurred while fetching user info: ${error}`);\n      });\n  }, []);\n\n  const handleLogOut = () => {\n    setToken(\"\");\n    window.localStorage.removeItem(\"token\");\n    window.location.href = \"/\";\n  };\n\n  if (!userData && !userTopItemsData) {\n    return <div>Loading...</div>;\n  }\n\n  return (\n    <div className=\"App\">\n      <h1>This is the callback page.</h1>\n      <button className=\"spotify-btn\" onClick={handleLogOut}>\n        Log out from Spotify\n      </button>\n      {userData && (\n        <div>\n          <h1>Welcome, {userData.display_name}!</h1>\n          <p>\n            Spotify Profile:{\" \"}\n            <a\n              href={userData.external_urls.spotify}\n              target=\"_blank\"\n              rel=\"noopener noreferrer\"\n            >\n              Visit Profile\n            </a>\n          </p>\n          <p>Followers: {userData.followers.total}</p>\n          {userData.images && userData.images.length > 0 && (\n            <img\n              src={userData.images[0].url}\n              alt={userData.display_name}\n              width={userData.images[0].width}\n              height={userData.images[0].height}\n            />\n          )}\n        </div>\n      )}\n\n      {userTopItemsData && <ArtistList artists={userTopItemsData.items} />}\n    </div>\n  );\n};\n\nexport default Callback;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}